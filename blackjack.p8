pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- blackjack
-- by koval

hand = {}
dealer = {}
counter = 0 -- for drawing purposes
player_score=0
af = 0 -- cursor anim frame
frame_counter = 1
stage = 0

function draw_card(x,y,n,m)
 if m>1 then pal(8,0)
 else pal() end
 n+=1
 sspr(8,0,11,16,x,y) --blank card
 sspr(128-n*8,0,6,6,x+2,y+2) --value
 sspr(24+m*8,8,5,5,x+3,y+9) --type
end

function draw_card_back(x,y)
 sspr(8,0,11,16,x,y)
 sspr(8,16,7,12,x+2,y+2)
end

function draw_player_cards(c)
	if (counter>#hand-1) counter=0
 draw_card(counter*11,100,c[1],c[2])
 counter+=1
end

function generate_card()
 return {flr(rnd(13)),flr(rnd(4))}
end

function add_hard_score(card)
 val=0
 if (card[1]==0) then 
 elseif card[1]>9 then val=10
 else val=card[1]+1 end
 player_score+=val
end

function add_soft_score(card)
 val=0
 if card[1]==0 then
  if player_score<11 then val=11
  else val=1 end
  player_score+=val
 end
end

function count_score(hand)
 player_score=0
 foreach(hand,add_hard_score)
 foreach(hand,add_soft_score)
 return player_score
end
-- main game functions --
-------------------------
function _init()

end

function _draw()
	rectfill(0,0,128,128,3)
	draw_card_back(40,10)
	draw_card_back(40,8)
	draw_card_back(40,6)
	foreach(hand,draw_player_cards)
	-- player counter
	print(count_score(hand),64,96,7)
 -- option selection window
 -- rectfill(7,31,35,65,7)
	-- rectfill(8,32,34,64,1)
	-- print("hit",10,34,7)
	-- print("stay",10,42)
	-- print("double",10,50)
	-- print("fold",10,58)
	-- spr(35+af,0,34) af+=1
	-- if (af>8) af=0
end

function _update()
 
 if frame_counter % 20 ==0 then
  -- stage 1: give player cards
  if stage==0 then
   if (#hand<2) add(hand,generate_card())
  end
  
 end
 
 frame_counter+=1
end

__gfx__
00000000001111111000000080080000088000000088800080088000088000000880000088880000088000008888000000880000088000000880000008800000
00000000017777777100000080880000800800000008000080800800800800008008000080080000800000008000000008080000800800008008000080080000
00700700177777777710000088800000800800000008000080800800088800000880000000800000888000008880000080080000008000000080000080080000
00077000177777777710000080880000800800000008000080800800000800008008000000800000800800000008000088880000000800000800000088880000
00077000177777777710000080080000088000008008000080800800000800008008000008000000800800008008000000080000800800008000000080080000
00700700177777777710000080080000008800000880000080088000088000000880000008000000088000000880000000080000088000008888000080080000
00000000177777777710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000177777777710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000177777777710000008080000008000000080000000800000000000000000000000000000000000000000000000000000000000000000000000000000
00000000177777777710000088888000088800000888000008880000000000000000000000000000000000000000000000000000000000000000000000000000
00000000177777777710000088888000888880008888800080808000000000000000000000000000000000000000000000000000000000000000000000000000
00000000177777777710000008880000088800008080800088088000000000000000000000000000000000000000000000000000000000000000000000000000
00000000177777777710000000800000008000000888000080808000000000000000000000000000000000000000000000000000000000000000000000000000
00000000177777777710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000017777777100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000711111700000000011000000000000000000000000000000000000000000000000000000770000007700000000000000000000000000000000000000
00000000111111100000000077110000110000000000000000000000000000000000000077000000777700007777000000000000000000000000000000000000
00000000111111100000000077771100771111001111000000000000000000007777000077777700777777007777770000000000000000000000000000000000
00000000111111100000000077777711777777117777111111111111777777777777777777777777777777777777777700000000000000000000000000000000
00000000111111100000000077777777777777777777777777777777111111117777111177777711777777117777777700000000000000000000000000000000
00000000111111100000000077777700777777007777000000000000000000001111000077111100777711007777770000000000000000000000000000000000
00000000111111100000000077770000770000000000000000000000000000000000000011000000771100007777000000000000000000000000000000000000
00000000111111100000000077000000000000000000000000000000000000000000000000000000110000007700000000000000000000000000000000000000
00000000111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000711111700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
